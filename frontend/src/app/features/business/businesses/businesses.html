<div class="businesses-page">
  <div class="page-header">
    <app-breadcrumbs [crumbs]="[
      { label: 'Dashboard', link: '/owner' },
      { label: 'My Businesses' }
    ]"></app-breadcrumbs>
  </div>
  <!-- Loading State -->
  <div class="loading-state" *ngIf="loadingBusinesses">
    <div class="spinner"></div>
    <p>Loading businesses...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loadingBusinesses && businesses.length === 0">
    <lucide-icon [img]="ShoppingBag" [size]="64" class="empty-icon"></lucide-icon>
    <h3>No Businesses Yet</h3>
    <p>Get started by creating your first business.</p>
    <a routerLink="/owner/businesses/new" class="btn-primary">
      <lucide-icon [img]="Plus" [size]="16"></lucide-icon>
      Create Your First Business
    </a>
  </div>

  <!-- Business Cards Grid -->
  <div class="businesses-grid" *ngIf="!loadingBusinesses && businesses.length > 0">
    <div class="business-card" *ngFor="let business of businesses" [routerLink]="['/owner/businesses', business._id]">
      <div class="card-header">
        <div class="business-icon" *ngIf="business.logo; else iconFallback">
          <img [src]="business.logo" [alt]="business.name" class="business-logo" />
        </div>
        <ng-template #iconFallback>
          <div class="business-icon">
            <lucide-icon [img]="ShoppingBag" [size]="24"></lucide-icon>
          </div>
        </ng-template>
        <div class="business-info">
          <h3 class="business-name">{{ business.name }}</h3>
          <span class="business-type">{{ business.category || business.type }}</span>
        </div>
      </div>

      <div class="card-body">
        <div class="info-item" *ngIf="business.location?.city">
          <lucide-icon [img]="MapPin" [size]="16"></lucide-icon>
          <span>{{ business.location.city }}, {{ business.location.state }}</span>
        </div>

        <div class="info-item" *ngIf="business.contact?.phone">
          <lucide-icon [img]="Phone" [size]="16"></lucide-icon>
          <span>{{ business.contact.phone }}</span>
        </div>

        <div class="info-item" *ngIf="business.rating?.average || business.stats?.avgRating">
          <lucide-icon [img]="Star" [size]="16"></lucide-icon>
          <span>{{ (business.rating?.average || business.stats?.avgRating || 0).toFixed(1) }} Rating</span>
        </div>
      </div>

      <div class="card-stats">
        <div class="stat-item">
          <lucide-icon [img]="Package" [size]="16"></lucide-icon>
          <span>{{ business.stats?.totalItems || 0 }} Items</span>
        </div>
        <div class="stat-item">
          <lucide-icon [img]="MessageSquare" [size]="16"></lucide-icon>
          <span>{{ business.stats?.totalReviews || 0 }} Reviews</span>
        </div>
      </div>

      <div class="card-actions" (click)="$event.stopPropagation()">
        <a [routerLink]="['/owner/businesses', business._id, 'items']" class="btn-action btn-items">
          <lucide-icon [img]="Package" [size]="16"></lucide-icon>
          <span>Manage Items</span>
        </a>
        <a [routerLink]="['/owner/businesses', business._id, 'edit']" class="btn-action btn-edit">
          <lucide-icon [img]="Edit" [size]="16"></lucide-icon>
          <span>Edit</span>
        </a>
        <button (click)="openDeleteModal(business)" class="btn-action btn-delete">
          <lucide-icon [img]="Trash2" [size]="16"></lucide-icon>
          <span>Delete</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeDeleteModal()">
  <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
    <button class="btn-close-modal" (click)="closeDeleteModal()" aria-label="Close">
      <lucide-icon [img]="X" [size]="20"></lucide-icon>
    </button>
    
    <div class="modal-header">
      <div class="warning-icon">
        <lucide-icon [img]="AlertTriangle" [size]="40"></lucide-icon>
      </div>
      <h3>Delete Business</h3>
      <p class="danger-text">This action cannot be undone!</p>
    </div>
    
    <div class="modal-body">
      <p class="confirmation-text">
        Type <strong>{{ businessToDelete?.name }}</strong> to confirm:
      </p>
      <input 
        type="text" 
        [(ngModel)]="deleteConfirmationText" 
        placeholder="Enter business name"
        class="confirmation-input"
        [class.error]="deleteConfirmationText && deleteConfirmationText !== businessToDelete?.name"
        autofocus
      />
    </div>
    
    <div class="modal-actions">
      <button class="btn-modal-cancel" (click)="closeDeleteModal()" [disabled]="deletingBusiness">
        Cancel
      </button>
      <button 
        class="btn-modal-danger" 
        (click)="confirmDeleteBusiness()" 
        [disabled]="deletingBusiness || deleteConfirmationText !== businessToDelete?.name"
      >
        <lucide-icon [img]="Trash2" [size]="16"></lucide-icon>
        {{ deletingBusiness ? 'Deleting...' : 'Delete' }}
      </button>
    </div>
  </div>
</div>
