<div class="items-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button (click)="goBack()" class="btn-back" title="Back">
        <lucide-icon [img]="ArrowLeft" [size]="20"></lucide-icon>
      </button>
      <div class="header-content">
        <h2>{{ business?.name || 'Items' }}</h2>
      </div>
    </div>
    <button *ngIf="businessId && items.length > 0" (click)="openAddModal()" class="btn-add-item">
      <lucide-icon [img]="Plus" [size]="18"></lucide-icon>
      <span>Add Item</span>
    </button>
  </div>
  
  <!-- Loading -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading items...</p>
  </div>
  
  <!-- Empty State -->
  <div *ngIf="!loading && items.length === 0" class="empty-state">
    <lucide-icon [img]="Package" [size]="64" class="empty-icon"></lucide-icon>
    <h3>No Items Yet</h3>
    <p>Start by adding your first menu item.</p>
    <button *ngIf="businessId" (click)="openAddModal()" class="btn-primary">
      <lucide-icon [img]="Plus" [size]="16"></lucide-icon>
      Add Your First Item
    </button>
  </div>
  
  <!-- Items Grid -->
  <div class="items-grid" *ngIf="!loading && items.length > 0">
    <div *ngFor="let item of items" class="item-card">
      <div class="item-image">
        <img 
          [src]="getItemImage(item) || getDefaultItemImage()" 
          [alt]="item.name"
          (error)="onItemImageError($event)"
        >
      </div>
      
      <div class="item-info">
        <h3>{{item.name}}</h3>
        <p class="category" *ngIf="item.category">{{item.category}}</p>
        <p class="description" *ngIf="item.description">{{item.description}}</p>
        
        <div class="item-stats">
          <div class="stat">
            <lucide-icon [img]="Star" [size]="14"></lucide-icon>
            <span>{{($any(item).stats?.averageRating || 0) | number:'1.1-1'}}</span>
          </div>
          <div class="stat">
            <lucide-icon [img]="MessageSquare" [size]="14"></lucide-icon>
            <span>{{($any(item).stats?.totalReviews || 0)}}</span>
          </div>
        </div>
        
        <div class="item-footer">
          <div class="price">
            <lucide-icon [img]="IndianRupee" [size]="16"></lucide-icon>
            <span>{{item.price}}</span>
          </div>
          <button (click)="openEditModal(item)" class="btn-edit">
            <lucide-icon [img]="Edit2" [size]="14"></lucide-icon>
            Edit
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{editMode ? 'Edit' : 'Add'}} Item</h2>
      <button (click)="closeModal()" class="btn-close">
        <lucide-icon [img]="X" [size]="20"></lucide-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <form>
        <div class="form-group">
          <label>Name *</label>
          <input 
            [(ngModel)]="itemForm.name" 
            name="name"
            placeholder="Item name" 
            class="form-input"
          >
        </div>
        
        <div class="form-group">
          <label>Description</label>
          <textarea 
            [(ngModel)]="itemForm.description" 
            name="description"
            placeholder="Description..." 
            class="form-input" 
            rows="2"
          ></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Price (â‚¹) *</label>
            <input 
              [(ngModel)]="itemForm.price" 
              name="price"
              type="number" 
              placeholder="0" 
              class="form-input"
              min="0"
            >
          </div>
          
          <div class="form-group">
            <label>Category</label>
            <input 
              [(ngModel)]="itemForm.category" 
              name="category"
              placeholder="Category" 
              class="form-input"
            >
          </div>
        </div>
        
        <div class="form-group">
          <label>Photos</label>
          <input 
            type="file" 
            #fileInput 
            (change)="onFileSelected($event)" 
            accept="image/*" 
            multiple 
            hidden
          >
          <button 
            type="button"
            (click)="fileInput.click()" 
            class="btn-upload"
          >
            <lucide-icon [img]="Upload" [size]="16"></lucide-icon>
            Upload Images
          </button>
          
          <div class="image-previews" *ngIf="imagePreviewUrls.length > 0">
            <div *ngFor="let url of imagePreviewUrls; let i = index" class="preview-item">
              <img [src]="url" alt="Preview">
              <button type="button" (click)="removeImage(i)" class="btn-remove">
                <lucide-icon [img]="X" [size]="14"></lucide-icon>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button (click)="closeModal()" class="btn-cancel">Cancel</button>
      <button (click)="saveItem()" class="btn-save">
        {{editMode ? 'Update' : 'Add'}} Item
      </button>
    </div>
  </div>
</div>
