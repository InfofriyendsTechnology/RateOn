<div class="dashboard-layout" [class.sidebar-collapsed]="!sidebarOpen">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <img *ngIf="sidebarOpen" src="/LOGO_WHITE.png" alt="RateOn" class="logo-full">
        <img *ngIf="!sidebarOpen" src="/LOGO_WHITE_ICON.png" alt="RateOn" class="logo-small">
      </div>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/business/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item">
        <lucide-icon [img]="LayoutDashboard" [size]="16" class="nav-icon"></lucide-icon>
        <span class="nav-text" *ngIf="sidebarOpen">Dashboard</span>
      </a>
      
      <div class="nav-divider" *ngIf="sidebarOpen"></div>
      <span class="nav-section-label" *ngIf="sidebarOpen">PUBLIC</span>
      
      <a routerLink="/explore" class="nav-item">
        <lucide-icon [img]="Compass" [size]="16" class="nav-icon"></lucide-icon>
        <span class="nav-text" *ngIf="sidebarOpen">Explore</span>
      </a>
      <a routerLink="/leaderboard" class="nav-item">
        <lucide-icon [img]="Trophy" [size]="16" class="nav-icon"></lucide-icon>
        <span class="nav-text" *ngIf="sidebarOpen">Leaderboard</span>
      </a>
      
      <div class="nav-divider" *ngIf="sidebarOpen"></div>
      <span class="nav-section-label" *ngIf="sidebarOpen">MANAGE</span>
      
      <a routerLink="/business/dashboard/items" routerLinkActive="active" class="nav-item">
        <lucide-icon [img]="ShoppingBag" [size]="16" class="nav-icon"></lucide-icon>
        <span class="nav-text" *ngIf="sidebarOpen">Items</span>
      </a>
      <a routerLink="/business/dashboard/settings" routerLinkActive="active" class="nav-item">
        <lucide-icon [img]="Settings" [size]="16" class="nav-icon"></lucide-icon>
        <span class="nav-text" *ngIf="sidebarOpen">Settings</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="user-avatar">
          <img *ngIf="getUserAvatar() && !avatarFailed" [src]="getUserAvatar()" [alt]="user?.username" 
               class="avatar-image" crossorigin="anonymous" referrerpolicy="no-referrer"
               (error)="onAvatarError($event)">
          <span *ngIf="!getUserAvatar() || avatarFailed" class="avatar-initial">{{ user?.username?.charAt(0).toUpperCase() }}</span>
        </div>
        <div class="user-info" *ngIf="sidebarOpen">
          <div class="user-name">{{ user?.username }}</div>
          <div class="user-role">Business Owner</div>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()" [title]="sidebarOpen ? '' : 'Logout'">
        <lucide-icon [img]="LogOut" [size]="16" class="logout-icon"></lucide-icon>
        <span *ngIf="sidebarOpen" class="logout-text">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <div class="top-bar">
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <lucide-icon [img]="Menu" [size]="20"></lucide-icon>
      </button>
      <div class="top-bar-content">
        <div class="page-title">
          <h1>Dashboard</h1>
        </div>
      </div>
    </div>

    <!-- Dashboard Content -->
    <router-outlet></router-outlet>
    <div class="dashboard-content" *ngIf="!isChildRouteActive()">
      
      <!-- Business Info Card -->
      <div class="welcome-card" *ngIf="business">
        <div class="welcome-header">
          <div>
            <h2>{{ business.name }}</h2>
            <p class="business-category">{{ business.category || 'Business' }}</p>
          </div>
          <a [routerLink]="['/business', business._id]" class="btn-view-public">
            View Public Profile
          </a>
        </div>
        <div class="business-quick-stats">
          <div class="quick-stat">
            <span class="stat-label">Location</span>
            <span class="stat-value">{{ business.location?.city || 'Not set' }}</span>
          </div>
          <div class="quick-stat">
            <span class="stat-label">Contact</span>
            <span class="stat-value">{{ business.contactInfo?.phone || 'Not set' }}</span>
          </div>
          <div class="quick-stat" *ngIf="business.rating">
            <span class="stat-label">Rating</span>
            <span class="stat-value">‚≠ê {{ business.rating.toFixed(1) }}</span>
          </div>
        </div>
      </div>

      <!-- No Business State -->
      <div class="empty-state" *ngIf="!business && !loadingBusiness">
        <lucide-icon [img]="ShoppingBag" [size]="48" class="empty-icon"></lucide-icon>
        <h3>No Business Yet</h3>
        <p>You haven't created a business yet. Contact support to create your first business profile.</p>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="loadingBusiness">
        <div class="spinner"></div>
        <p>Loading business data...</p>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions" *ngIf="business">
        <h3>Quick Actions</h3>
        <div class="action-grid">
          <a routerLink="/business/dashboard/items" class="action-card">
            <lucide-icon [img]="ShoppingBag" [size]="20"></lucide-icon>
            <span>Manage Items</span>
          </a>
          <a [routerLink]="['/business/dashboard/edit', business._id]" class="action-card">
            <lucide-icon [img]="Edit" [size]="20"></lucide-icon>
            <span>Edit Business</span>
          </a>
          <a routerLink="/business/dashboard/settings" class="action-card">
            <lucide-icon [img]="Settings" [size]="20"></lucide-icon>
            <span>Settings</span>
          </a>
        </div>
      </div>

    </div>
  </main>
</div>
