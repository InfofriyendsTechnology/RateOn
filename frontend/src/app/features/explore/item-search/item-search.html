<div class="item-search-container">
  <!-- Header -->
  <div class="page-header">
    <h1>Search Items</h1>
    <p>Find and review items from businesses</p>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <div class="search-bar">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        [(ngModel)]="searchQuery"
        (keyup.enter)="searchItems()"
        placeholder="Search for items (e.g., pizza, burger, coffee...)"
        class="search-input"
      />
      <button (click)="searchItems()" class="search-btn" [disabled]="!searchQuery.trim()">
        Search
      </button>
    </div>

    <!-- Filters -->
    <div class="filters">
      <select [(ngModel)]="selectedCategory" (change)="searchItems()" class="filter-select">
        <option value="">All Categories</option>
        <option *ngFor="let cat of categories" [value]="cat">{{cat}}</option>
      </select>

      <div class="price-filter">
        <input 
          type="number" 
          [(ngModel)]="minPrice" 
          (change)="searchItems()"
          placeholder="Min ₹"
          class="price-input"
        />
        <span class="separator">-</span>
        <input 
          type="number" 
          [(ngModel)]="maxPrice" 
          (change)="searchItems()"
          placeholder="Max ₹"
          class="price-input"
        />
      </div>

      <select [(ngModel)]="sortBy" (change)="searchItems()" class="filter-select">
        <option value="relevance">Most Relevant</option>
        <option value="rating">Highest Rated</option>
        <option value="reviews">Most Reviewed</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
      </select>

      <button (click)="clearFilters()" class="clear-filters-btn">
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Results -->
  <div class="results-section">
    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Searching items...</p>
    </div>

    <!-- No Results -->
    <div *ngIf="!loading && searched && items.length === 0" class="no-results">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <h3>No items found</h3>
      <p>Try different keywords or filters</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !searched" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <h3>Start Searching</h3>
      <p>Search for items to find and review</p>
    </div>

    <!-- Results Grid -->
    <div *ngIf="!loading && items.length > 0" class="results-grid">
      <div class="results-header">
        <h2>Found {{items.length}} item{{items.length !== 1 ? 's' : ''}}</h2>
      </div>

      <div class="items-grid">
        <div *ngFor="let item of items" class="item-card" (click)="viewItem(item)">
          <div class="item-image">
            <img [src]="item.images?.[0] || 'assets/placeholder-item.jpg'" [alt]="item.name">
            <span class="availability-badge" [class.available]="item.availability?.status === 'available'">
              {{item.availability?.status === 'available' ? 'Available' : 'Unavailable'}}
            </span>
          </div>

          <div class="item-content">
            <h3 class="item-name">{{item.name}}</h3>
            <p class="business-name">
              <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              </svg>
              {{item.businessName || 'Business'}}
            </p>

            <p class="item-description" *ngIf="item.description">
              {{item.description}}
            </p>

            <div class="item-rating">
              <div class="stars">
                <span *ngFor="let star of getRatingArray(item.averageRating || 0)" class="star filled">★</span>
                <span *ngIf="hasHalfStar(item.averageRating || 0)" class="star half">★</span>
                <span *ngFor="let star of getEmptyStars(item.averageRating || 0)" class="star empty">☆</span>
              </div>
              <span class="rating-text">
                {{item.averageRating || 0 | number:'1.1-1'}} ({{item.reviewCount || 0}})
              </span>
            </div>

            <div class="item-footer">
              <span class="price">₹{{item.price}}</span>
              <button 
                class="review-btn" 
                [class.viewed]="item.hasUserReview"
                (click)="writeReview(item, $event)"
              >
                {{getReviewButtonText(item)}}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
